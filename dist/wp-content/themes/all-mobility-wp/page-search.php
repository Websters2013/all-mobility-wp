<?php
/**
 * Template Name: Search Page
 */
get_header(); ?>

    <?php woocommerce_breadcrumb(); ?>

    <!-- site__content -->
    <div class="site__content site__content_page site__white-back">

        <!-- site__content__wrap -->
        <div class="site__content__wrap">

            <!-- site__inner -->
            <div class="site__inner">

                <!-- search-results -->
                <div class="search-results">

                    <!-- search -->
                    <div class="search" data-path="php/search.php" data-action="http://www.erefre.com">

                        <form action="<?= get_permalink(444) ?>">
                            <input type="search" name="search" id="search3" autocomplete="off" placeholder="Enter  your search here">
                            <button type="submit">search</button>
                        </form>

                        <!-- search__result -->
                        <div class="search__result">

                            <div>

                                <ul class="search__found">
                                    <li><a href="#">Wheelchairs</a>

                                        <ul>
                                            <li><a href="#">Transport Wheelchairs</a></li>
                                            <li><a href="#">Standard Wheelchairs</a></li>
                                            <li><a href="#">Lightweight Wheelchairs</a></li>
                                            <li><a href="#">Ultralightweight Wheelchairs</a></li>
                                        </ul>

                                    </li>
                                    <li><a href="#">3-Wheel Chair</a></li>
                                    <li><a href="#">4-Wheel Rollators</a></li>
                                    <li><a href="#">3-Wheel Rollators</a></li>
                                    <li><a href="#">Wagon Wheels</a></li>
                                    <li><a href="#">Wheelie Wonkie</a></li>
                                </ul>

                            </div>
                            <div>

                                <!-- top-products -->
                                <div class="top-products">

                                    <h2 class="top-products__title">Top Products</h2>

                                    <!-- top-products__wrap -->
                                    <div class="top-products__wrap">
                                        <div>

                                            <!-- top-products__item -->
                                            <div class="top-products__item">

                                                <!-- top-products__pic -->
                                                <div class="top-products__pic">

                                                    <img src="pic/lift-chairs.png" width="414" height="414" alt="">

                                                </div>
                                                <!-- /top-products__pic -->

                                                <!-- top-products__price -->
                                                <span class="top-products__price"><del>$1,800</del> $1,350</span>
                                                <!-- /top-products__price -->

                                                <!-- top-products__item-title -->
                                                <h3 class="top-products__item-title">Wheelchairs
                                                    Product Title</h3>
                                                <!-- /top-products__item-title -->

                                                <!-- top-products__btn -->
                                                <a href="#" class="top-products__btn">view</a>
                                                <!-- /top-products__btn -->

                                            </div>
                                            <!-- /top-products__item -->

                                        </div>
                                        <div>

                                            <!-- top-products__item -->
                                            <div class="top-products__item">

                                                <!-- top-products__pic -->
                                                <div class="top-products__pic">

                                                    <img src="pic/lift-chairs.png" width="414" height="414" alt="">

                                                </div>
                                                <!-- /top-products__pic -->

                                                <!-- top-products__price -->
                                                <span class="top-products__price"><del>$1,800</del> $1,350</span>
                                                <!-- /top-products__price -->

                                                <!-- top-products__item-title -->
                                                <h3 class="top-products__item-title">Wheelchairs
                                                    Product Title</h3>
                                                <!-- /top-products__item-title -->

                                                <!-- top-products__btn -->
                                                <a href="#" class="top-products__btn">view</a>
                                                <!-- /top-products__btn -->

                                            </div>
                                            <!-- /top-products__item -->

                                        </div>
                                        <div>

                                            <!-- top-products__item -->
                                            <div class="top-products__item">

                                                <!-- top-products__pic -->
                                                <div class="top-products__pic">

                                                    <img src="pic/lift-chairs.png" width="414" height="414" alt="">

                                                </div>
                                                <!-- /top-products__pic -->

                                                <!-- top-products__price -->
                                                <span class="top-products__price"><del>$1,800</del> $1,350</span>
                                                <!-- /top-products__price -->

                                                <!-- top-products__item-title -->
                                                <h3 class="top-products__item-title">Wheelchairs
                                                    Product Title</h3>
                                                <!-- /top-products__item-title -->

                                                <!-- top-products__btn -->
                                                <a href="#" class="top-products__btn">view</a>
                                                <!-- /top-products__btn -->

                                            </div>
                                            <!-- /top-products__item -->

                                        </div>
                                        <div>

                                            <!-- top-products__item -->
                                            <div class="top-products__item">

                                                <!-- top-products__pic -->
                                                <div class="top-products__pic">

                                                    <img src="pic/lift-chairs.png" width="414" height="414" alt="">

                                                </div>
                                                <!-- /top-products__pic -->

                                                <!-- top-products__price -->
                                                <span class="top-products__price"><del>$1,800</del> $1,350</span>
                                                <!-- /top-products__price -->

                                                <!-- top-products__item-title -->
                                                <h3 class="top-products__item-title">Wheelchairs
                                                    Product Title</h3>
                                                <!-- /top-products__item-title -->

                                                <!-- top-products__btn -->
                                                <a href="#" class="top-products__btn">view</a>
                                                <!-- /top-products__btn -->

                                            </div>
                                            <!-- /top-products__item -->

                                        </div>
                                        <div>

                                            <!-- top-products__item -->
                                            <div class="top-products__item">

                                                <!-- top-products__pic -->
                                                <div class="top-products__pic">

                                                    <img src="pic/lift-chairs.png" width="414" height="414" alt="">

                                                </div>
                                                <!-- /top-products__pic -->

                                                <!-- top-products__price -->
                                                <span class="top-products__price"><del>$1,800</del> $1,350</span>
                                                <!-- /top-products__price -->

                                                <!-- top-products__item-title -->
                                                <h3 class="top-products__item-title">Wheelchairs
                                                    Product Title</h3>
                                                <!-- /top-products__item-title -->

                                                <!-- top-products__btn -->
                                                <a href="#" class="top-products__btn">view</a>
                                                <!-- /top-products__btn -->

                                            </div>
                                            <!-- /top-products__item -->

                                        </div>
                                        <div>

                                            <!-- top-products__item -->
                                            <div class="top-products__item">

                                                <!-- top-products__pic -->
                                                <div class="top-products__pic">

                                                    <img src="pic/lift-chairs.png" width="414" height="414" alt="">

                                                </div>
                                                <!-- /top-products__pic -->

                                                <!-- top-products__price -->
                                                <span class="top-products__price"><del>$1,800</del> $1,350</span>
                                                <!-- /top-products__price -->

                                                <!-- top-products__item-title -->
                                                <h3 class="top-products__item-title">Wheelchairs
                                                    Product Title</h3>
                                                <!-- /top-products__item-title -->

                                                <!-- top-products__btn -->
                                                <a href="#" class="top-products__btn">view</a>
                                                <!-- /top-products__btn -->

                                            </div>
                                            <!-- /top-products__item -->

                                        </div>
                                    </div>
                                    <!-- /top-products__wrap -->

                                </div>
                                <!-- /top-products -->

                            </div>

                        </div>
                        <!-- /search__result -->

                    </div>
                    <!-- /search -->

                    <?php
                    if(isset($_GET['search'])):

                    $query = $_GET['search'];

                    if( $query ):

                    $products = getProductsSearch($query, -1);
                        $count = count($products);
                        if($count<=1){
                            $results = 'result';
                        } else {
                            $results = 'results';
                        }

                        ?>

                    <h1 class="site__title site__title_8">Search Results for <?= $query ?> - <?= $count.' '.$results ?></h1>

                    <!-- featured-products -->
                    <div class="featured-products featured-products_4">

                        <!-- featured-products__inner -->
                        <div class="featured-products__inner">

                            <?php foreach ( $products as $id) {

                                $thumb_id = get_post_thumbnail_id($id);
                                $thumb_url = wp_get_attachment_image_src($thumb_id,'full')[0];
                                $_product = wc_get_product($id);
                                ?>

                                <div>

                                    <!-- featured-product -->
                                    <a href="<?= get_permalink($id) ?>" class="featured-product">
                                        <h4 class="featured-product__title"><?= get_the_title($id) ?></h4>

                                        <div class="featured-product__pic" style="background-image: url(<?= $thumb_url ?>)">
                                        </div>

                                        <div class="featured-product__footer">
                                            <span class="featured-product__price"><?= $_product->get_price_html() ?>
                                            <span class="btn btn_6">SEE MORE</span>
                                        </div>

                                    </a>
                                    <!-- /featured-product -->

                                </div>

                           <?php  } ?>

                        </div>
                        <!-- /featured-products__inner -->

                    </div>
                    <!-- /featured-products -->

                    <?php endif; ?>


                    <?php $categories = getTermsForSearch($query, "");
                    
                    $count = count($categories);
                    if($count<=1){
                        $results = 'result';
                    } else {
                        $results = 'results';
                    }

                    if( $categories ): ?>

                    <!-- search-results__items -->
                    <div class="search-results__items">

                        <h2 class="site__title site__title_7">Search Results for <?= $query ?> - <?= $count.' '.$results ?></h2>

                        <?php foreach ($categories as $key => $category_id):

                            $category = get_term($key,'product_cat');

                            $catName = $category->name;

                            $description = $category->description;

                            $catName = str_replace($query,"<span>$query</span>",$catName);

                            $term_link = get_term_link($key);

                            ?>

                            <!-- search-results__items -->
                            <div class="search-results__item">

                                <h3 class="search-results__title">
                                    <a href="<?= $term_link ?>"><?= $catName ?></a>
                                </h3>

                                <p><?= $description ?></p>

                                <a href="<?= $term_link ?>" class="btn btn_15">READ MORE</a>

                            </div>
                            <!-- /search-results__items -->

                        <?php endforeach; ?>

                    </div>
                    <!-- /search-results__items -->

                    <?php endif;
                    else :
                        echo '<h1 class="site__title site__title_8">Not Found</h1>';
                    endif;

                    ?>

                </div>
                <!-- /search-results -->

            </div>
            <!-- /site__inner -->

            <!-- site__aside -->
            <aside class="site__aside">

              <?php get_template_part('content/content','aside-contact') ?>

            </aside>
            <!-- /site__aside -->

        </div>
        <!-- /site__content__wrap -->

    </div>
    <!-- /site__content -->

<?php get_footer(); ?>